<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ç­ç´šäº‹å‹™é€šçŸ¥å°å¹«æ‰‹liteç‰ˆ</title>
  
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root {
      --line-green: #06C755;
      --line-dark: #00B900;
      --btn-blue: #4A90E2;
      --btn-dark-green: #048A3B;
      --bg-gray: #F5F7FA;
      --text-color: #333;
    }

    body { font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif; background-color: var(--bg-gray); margin: 0; padding: 0; color: var(--text-color); padding-bottom: 20px; }
    
    header { background-color: var(--line-green); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    header h1 { margin: 0; font-size: 18px; font-weight: bold; }
    .header-btns { display: flex; gap: 8px; }
    .header-btn { background: rgba(255,255,255,0.2); border: none; color: white; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold; }
    
    .container { max-width: 600px; margin: 15px auto; padding: 0 15px; }
    .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    label { display: block; font-weight: bold; margin-bottom: 8px; color: #555; font-size: 14px; }
    
    select, input[type="text"], textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; outline: none; background-color: #FAFAFA; }
    select { appearance: none; -webkit-appearance: none; }
    textarea:focus, input[type="text"]:focus { border-color: var(--line-green); background-color: #fff; }
    
    .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; }
    .student-btn { background-color: white; border: 1px solid #ddd; padding: 10px 5px; border-radius: 8px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.1s; }
    .student-btn.selected { background-color: var(--line-green); color: white; border-color: var(--line-green); }
    .btn-no { font-size: 12px; color: #888; margin-bottom: 4px; }
    .student-btn.selected .btn-no { color: #E0F2F1; }
    .btn-name { font-size: 16px; font-weight: bold; }

    .btn-whole-class { width: 100%; padding: 12px; border: 2px dashed #ccc; border-radius: 8px; background-color: #fafafa; color: #555; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 15px; transition: all 0.2s; }
    .btn-whole-class:hover { border-color: var(--line-green); color: var(--line-green); }
    .btn-whole-class.selected-whole { background-color: var(--line-green); color: white; border: 2px solid var(--line-green); }

    .action-group { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
    .action-btn { width: 100%; padding: 14px; border: none; border-radius: 8px; color: white; font-size: 16px; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.1s; }
    .action-btn:active { transform: scale(0.98); }
    .btn-copy { background-color: var(--btn-blue); }
    .btn-line-app { background-color: var(--line-green); }
    .btn-line-oa { background-color: var(--btn-dark-green); }

    /* Modal & Table æ¨£å¼ (åŠ å¯¬ä»¥å®¹ç´è¡¨æ ¼) */
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; justify-content: center; align-items: center; }
    .modal-content { background: white; width: 95%; max-width: 800px; max-height: 90vh; border-radius: 12px; padding: 20px; overflow-y: auto; box-sizing: border-box; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .modal-header h2 { margin: 0; font-size: 18px; color: var(--line-dark); }
    .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #888; }
    
    /* è¡¨æ ¼æ¨£å¼ */
    .table-container { max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; }
    table { width: 100%; border-collapse: collapse; min-width: 400px; }
    th { background-color: #f4f4f4; padding: 10px; text-align: left; position: sticky; top: 0; z-index: 10; border-bottom: 2px solid #ddd; }
    td { padding: 5px; border-bottom: 1px solid #eee; }
    td input { padding: 8px; font-size: 14px; border: 1px solid transparent; background: transparent; }
    td input:focus { border: 1px solid var(--line-green); background: #fff; }
    .del-btn { background: #ff4d4f; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; }
    .del-btn:hover { background: #d9363e; }
    .add-row-btn { background: #f0f0f0; border: 1px dashed #ccc; padding: 10px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; color: #555; margin-bottom: 20px; }
    .add-row-btn:hover { background: #e8e8e8; }

    /* Excel æ“ä½œå€ */
    .excel-group { display: flex; gap: 10px; margin-bottom: 20px; background: #e6f7ff; padding: 15px; border-radius: 8px; border: 1px solid #91d5ff; }
    .excel-btn { flex: 1; padding: 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; }
    .btn-download { background: var(--btn-blue); }
    .btn-import { background: var(--line-dark); }

    .save-btn { background: var(--line-green); color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; font-size: 16px; font-weight: bold; margin-top: 15px; cursor: pointer; }
    .backup-group { display: flex; gap: 10px; margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px; }
    .backup-btn { flex: 1; padding: 10px; border: 1px solid var(--line-green); background: white; color: var(--line-green); border-radius: 8px; font-weight: bold; cursor: pointer; }
    .help-text { font-size: 12px; color: #888; margin-top: 4px; margin-bottom: 10px; }
    
    /* ç™¼é€ç´€éŒ„æ¨£å¼ */
    .history-item { border-bottom: 1px solid #eee; padding: 10px 0; }
    .history-time { font-size: 12px; color: #888; margin-bottom: 4px; }
    .history-to { font-size: 14px; font-weight: bold; color: var(--line-dark); margin-bottom: 4px; }
    .history-text { font-size: 14px; color: #444; white-space: pre-wrap; }
    .no-history { text-align: center; color: #999; padding: 20px 0; }

    footer { text-align: center; font-size: 13px; color: #777; margin-top: 30px; line-height: 1.6; }
    footer a { color: var(--line-dark); text-decoration: none; font-weight: bold; display: inline-block; margin-top: 5px; padding: 5px 10px; border: 1px solid #ddd; border-radius: 20px; background: white; }
    footer a:hover { background: var(--line-green); color: white; border-color: var(--line-green); }
  </style>
</head>
<body>

  <header>
    <h1>ç­ç´šäº‹å‹™é€šçŸ¥å°å¹«æ‰‹liteç‰ˆ</h1>
    <div class="header-btns">
      <button class="header-btn" onclick="openHistory()">ğŸ“œ ç´€éŒ„</button>
      <button class="header-btn" onclick="openSettings()">âš™ï¸ æ§åˆ¶å°</button>
    </div>
  </header>

  <div class="container">
    <div class="card">
      <label>1. é¸æ“‡ç­ç´š</label>
      <select id="classSelect" onchange="renderStudents()"></select>
      <br><br>
      <label>2. é¸æ“‡é€šçŸ¥äº‹é …</label>
      <select id="statusSelect"></select>
      <input type="text" id="customNote" placeholder="è¼¸å…¥æ¥çºŒæ–‡å­—æˆ–å…¨æ–°é€šçŸ¥ (é¸å¡«)..." style="margin-top: 10px;">
    </div>

    <div class="card">
      <label>3. é»æ“Šç™¼é€å°è±¡ (å–®é¸ç¢ºèª)</label>
      <div class="grid-container" id="studentGrid"></div>
      <button id="btnWholeClass" class="btn-whole-class" onclick="selectWholeClass(this)">ğŸ“¢ å…¨ç­ (ä¸è¼‰å…¥å­¸ç”Ÿå§“å)</button>
    </div>

    <div class="card" id="previewCard" style="display:none; border-left: 4px solid var(--line-green);">
      <label>4. ç¢ºèªèˆ‡ç·¨è¼¯ç™¼é€å…§å®¹ï¼š</label>
      <div class="help-text">æ‚¨å¯ç›´æ¥åœ¨æ­¤æ–¹å¡Šå…§ä¿®æ”¹æ–‡å­—ï¼Œç¢ºèªç„¡èª¤å¾Œå†é»æ“Šä¸‹æ–¹æŒ‰éˆ•ç™¼é€ã€‚</div>
      <textarea id="msgPreview" rows="5" style="border: 1px solid var(--line-green);"></textarea>
      
      <div class="action-group">
        <button class="action-btn btn-copy" onclick="processSend('copy')">ğŸ“‹ è¤‡è£½æ–‡å­—</button>
        <button class="action-btn btn-line-app" onclick="processSend('lineApp')">ğŸ’¬ ç™¼é€åˆ° LINE (è·³è½‰ App)</button>
        <button class="action-btn btn-line-oa" onclick="processSend('lineOA')">ğŸ¤– ç™¼é€åˆ° LINE å®˜æ–¹å¸³è™Ÿ</button>
      </div>
    </div>
  </div>

  <footer>
    2026@å¥•éˆè€å¸«è£½ä½œ liteç‰ˆ V.7<br>
    <a href="https://www.facebook.com/profile.php?id=61584090122881" target="_blank">ğŸ‘‰ è¿½è¹¤ã€Œå¥•éˆè€å¸«ã€ç²‰å°ˆï¼Œç²å–æ›´å¤šæ•™å­¸ç¥å™¨ï¼</a>
  </footer>

  <div id="settingsModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>âš™ï¸ ç³»çµ±æ§åˆ¶å° (è¡¨æ ¼ç·¨è¼¯æ¨¡å¼)</h2>
        <button class="close-btn" onclick="closeSettings()">Ã—</button>
      </div>

      <div class="excel-group">
        <button class="excel-btn btn-download" onclick="downloadExcelTemplate()">ğŸ“¥ ä¸‹è¼‰ Excel ç¯„æœ¬æª”</button>
        <input type="file" id="excelUpload" accept=".xlsx, .xls" style="display:none;" onchange="importExcel(event)">
        <button class="excel-btn btn-import" onclick="document.getElementById('excelUpload').click()">ğŸ“¤ åŒ¯å…¥ Excel æª”æ¡ˆ</button>
      </div>
      
      <label>ğŸ§‘â€ğŸ“ å­¸ç”Ÿåå–®</label>
      <div class="table-container">
        <table id="studentsTable">
          <thead>
            <tr><th width="25%">ç­ç´š</th><th width="25%">åº§è™Ÿ</th><th width="35%">å§“å</th><th width="15%">æ“ä½œ</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <button class="add-row-btn" onclick="addTableRow('studentsTable')">+ æ–°å¢ä¸€ç­†å­¸ç”Ÿ</button>

      <label>ğŸ“ é€šçŸ¥äº‹é …</label>
      <div class="table-container">
        <table id="statusesTable">
          <thead>
            <tr><th width="30%">åˆ†é¡</th><th width="55%">å…§å®¹</th><th width="15%">æ“ä½œ</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <button class="add-row-btn" onclick="addTableRow('statusesTable')">+ æ–°å¢ä¸€ç­†é€šçŸ¥</button>

      <label>ğŸ”— å®˜æ–¹å¸³è™Ÿ Webhook ç¶²å€ (é€²éšé¸å¡«)</label>
      <input type="text" id="settingWebhook" placeholder="https://hook.make.com/...">

      <button class="save-btn" onclick="saveSettings()">ğŸ’¾ å„²å­˜è¡¨æ ¼è³‡æ–™ä¸¦è¼‰å…¥</button>

      <div class="backup-group">
        <button class="backup-btn" onclick="exportData()">ğŸ“¤ åŒ¯å‡ºå‚™ä»½ä»£ç¢¼</button>
        <button class="backup-btn" onclick="importData()">ğŸ“¥ è²¼ä¸Šä»£ç¢¼é‚„åŸ</button>
      </div>
    </div>
  </div>

  <div id="historyModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ“œ åœ¨åœ°ç™¼é€ç´€éŒ„ç°¿</h2>
        <button class="close-btn" onclick="closeHistory()">Ã—</button>
      </div>
      <div class="help-text">ç´€éŒ„ä¿å­˜åœ¨æ­¤ç€è¦½å™¨ä¸­ï¼Œæœ€å¤šé¡¯ç¤ºæœ€è¿‘ 50 ç­†ã€‚</div>
      <div id="historyList"></div>
    </div>
  </div>

  <script>
    const defaultStudents = `101,1,å‘¨æ°å€«\n101,2,è”¡ä¾æ—\n101,3,æ—ä¿Šå‚‘\n101,4,é„§ç´«æ£‹\n101,5,è•­æ•¬é¨°\n101,6,ç”°é¦¥ç”„\n101,7,ç›§å»£ä»²\n101,8,è‰¾æ€¡è‰¯\n101,9,éŸ‹ç¦®å®‰\n101,10,å­«ç‡•å§¿\n101,11,é™³å¥•è¿…\n101,12,æ¢éœèŒ¹\n101,13,äº”æœˆå¤©\n101,14,å¼µæƒ å¦¹\n202,15,ææ¦®æµ©\n202,16,æ¥Šä¸ç³\n202,17,è¨±å…‰æ¼¢\n202,18,æ¡‚ç¶¸é‚\n202,19,åŠ‰ä»¥è±ª\n202,20,ç‹æ·¨\n202,21,å½­äºæ™\n202,22,èˆ’æ·‡\n202,23,é‡‘åŸæ­¦\n202,24,è³ˆéœé›¯\n202,25,å³æ…·ä»`;
    const defaultStatuses = `ç­ç´šå…±åŒäº‹é …,æ˜æ—¥æœ‰é«”è‚²èª²ï¼Œè«‹æé†’å­©å­ç©¿è‘—é«”è‚²æœè£åˆ°æ ¡ã€‚
ç­ç´šå…±åŒäº‹é …,ä»Šæ—¥æœ‰ç™¼æ”¾é‡è¦å›æ¢ï¼Œè«‹å®¶é•·æ’¥å†—è©³é–±ä¸¦ç°½åï¼Œå‹™å¿…æé†’å­©å­æ˜æ—¥äº¤å›ï¼Œè¬è¬é…åˆã€‚
ç­ç´šå…±åŒäº‹é …,ä¸‹é€±å³å°‡é€²è¡ŒæœŸä¸­è©•é‡ï¼Œè«‹å®¶é•·å”åŠ©ç£ä¿ƒå­©å­åœ¨å®¶è¤‡ç¿’åŠŸèª²ï¼Œé ç¥è€ƒè©¦é †åˆ©ï¼
ç­ç´šå…±åŒäº‹é …,è¿‘æœŸå¤©æ°£è®ŠåŒ–å¤§ï¼Œæ—©æ™šæº«å·®æ˜é¡¯ï¼Œè«‹å®¶é•·æé†’å­©å­å¤šå¸¶ä¸€ä»¶ä¿æš–è¡£ç‰©ï¼Œæ³¨æ„èº«é«”å¥åº·ã€‚
ç­ç´šå…±åŒäº‹é …,æœ¬é€±äº”æ™šä¸Šç‚ºå­¸æ ¡ç­è¦ªæœƒï¼Œèª æ‘¯é‚€è«‹å®¶é•·å€‘è¸´èºåƒèˆ‡ï¼Œä¸€åŒé—œå¿ƒå­©å­åœ¨æ ¡çš„å­¸ç¿’ç‹€æ³ï¼
æ­£å‘é¼“å‹µèˆ‡ç”Ÿæ´»é—œæ‡·,ä»Šå¤©åœ¨å­¸æ ¡è¡¨ç¾éå¸¸å‡ºè‰²ï¼Œä¸åƒ…ä¸»å‹•åƒèˆ‡èª²å ‚è¨è«–ï¼Œå­¸ç¿’æ…‹åº¦ä¹Ÿååˆ†ç©æ¥µï¼Œå€¼å¾—å¤§å¤§çš„é¼“å‹µï¼ çœ‹åˆ°å­©å­æŒçºŒé€²æ­¥ï¼Œè€å¸«ä¹Ÿæ„Ÿåˆ°å¾ˆæ¬£æ…°ï¼Œå¸Œæœ›å­©å­èƒ½å¸¶è‘—é€™ä»½è‡ªä¿¡ç¹¼çºŒåŠ æ²¹ã€‚
æ­£å‘é¼“å‹µèˆ‡ç”Ÿæ´»é—œæ‡·,æœ€è¿‘åœ¨æ•¸å­¸èª²ä¸Šçœ¼ç›é–ƒé–ƒç™¼äº®ï¼Œä¸åƒ…å‹‡æ•¢èˆ‰æ‰‹ç™¼è¨€ï¼Œç­”é¡Œæ­£ç¢ºç‡ä¹Ÿæé«˜è¨±å¤šã€‚é€™ä»½è‡ªä¿¡çš„å»ºç«‹å°å­©å­å¾ˆé‡è¦ï¼Œè«‹å®¶é•·åœ¨å®¶ä¹Ÿçµ¦äºˆè‚¯å®šï¼
æ­£å‘é¼“å‹µèˆ‡ç”Ÿæ´»é—œæ‡·,åœ¨ä»Šæ—¥å¤§æƒé™¤æ™‚é–“ï¼Œè² è²¬çš„å€åŸŸæ‰“æƒå¾—ä¸€å¡µä¸æŸ“ï¼Œå±•ç¾äº†æ¥µä½³çš„è²¬ä»»æ„Ÿèˆ‡åšäº‹ç´°ç·»åº¦ï¼Œå€¼å¾—è¡¨æšï¼
æ­£å‘é¼“å‹µèˆ‡ç”Ÿæ´»é—œæ‡·,ä½œæ¥­å®Œæˆçš„é€Ÿåº¦å¾ˆå¿«ï¼Œè‹¥èƒ½å†å¤šèŠ±ä¸€é»å¿ƒæ€åœ¨å­—é«”çš„å·¥æ•´åº¦ä¸Šï¼Œç›¸ä¿¡æœƒæ›´èƒ½å±•ç¾ä»–çš„å­¸ç¿’æˆæœã€‚å†è«‹å®¶é•·å”åŠ©æé†’å­©å­éœä¸‹å¿ƒæ›¸å¯«ï¼ŒæœŸå¾…çœ‹åˆ°ä»–å„ªè³ªçš„ä½œå“ã€‚
ç”Ÿæ´»ä½œæ¯èˆ‡çªç™¼ç‹€æ³,ä»Šå¤©åœ¨æ ¡åæ‡‰èº«é«”ä¸èˆ’æœï¼Œè€å¸«å·²å…ˆå¸¶å­©å­å‰å¾€å¥åº·ä¸­å¿ƒä¼‘æ¯ä¸¦è§€å¯Ÿã€‚è«‹å®¶é•·å›å®¶å¾Œå¤šç•™æ„å­©å­çš„å¾ŒçºŒç‹€æ³ï¼Œè‹¥ä»æœ‰ä¸é©ï¼Œå»ºè­°å¤šä¼‘æ¯ã€‚ç¥ç¦å­©å­æ—©æ—¥åº·å¾©ã€‚
ç”Ÿæ´»ä½œæ¯èˆ‡çªç™¼ç‹€æ³,ä»Šæ—¥å°šæœªåˆ°æ ¡ï¼Œæƒ³èˆ‡æ‚¨ç¢ºèªå­©å­æ˜¯å¦èº«é«”ä¸é©æˆ–éœ€è¾¦ç†è«‹å‡æ‰‹çºŒï¼Ÿè‹¥æœ‰ç›¸é—œéœ€æ±‚ï¼Œå†è«‹å®¶é•·æ’¥å†—å›è¦†æˆ–è‡´é›»å­¸æ ¡å‘ŠçŸ¥ï¼Œè¬è¬æ‚¨çš„é…åˆã€‚
ç”Ÿæ´»ä½œæ¯èˆ‡çªç™¼ç‹€æ³,æœ€è¿‘åœ¨æ ¡èˆ‡è€å¸«äº’å‹•è‰¯å¥½ï¼Œä½†é€™å¹¾å¤©è§€å¯Ÿåˆ°ä»–ä¸Šèª²æ™‚ç²¾ç¥ä¸ä½³ï¼Œè€å¸«æœ‰äº›æ“”å¿ƒã€‚å†è«‹å®¶é•·å”åŠ©ç•™æ„å­©å­çš„å±…å®¶ä½œæ¯èˆ‡ç¡çœ å“è³ªï¼Œç¢ºä¿å­©å­æœ‰å……æ²›çš„é«”åŠ›æ‡‰ä»˜æ ¡åœ’ç”Ÿæ´»ï¼Œè¾›è‹¦äº†ã€‚
ç”Ÿæ´»ä½œæ¯èˆ‡çªç™¼ç‹€æ³,å¹³æ™‚æ˜¯å€‹æ´»æ½‘çš„å­©å­ï¼Œä¸éä»Šæ—¥åœ¨æ ¡ç™¼ç”Ÿäº†ä¸€äº›é•è¦ç‹€æ³ã€‚ç‚ºäº†å®Œæ•´èªªæ˜ç´°ç¯€ä¸¦èˆ‡æ‚¨å•†è¨è¼”å°æ–¹å¼ï¼Œè€å¸«ç¨æ™šæœƒå†è¦ªè‡ªè‡´é›»èªªæ˜ã€‚å¸Œæœ›èƒ½é€éè¦ªå¸«å…±åŒå¼•å°ï¼Œå¹«åŠ©å­©å­å­¸ç¿’æ›´å¦¥é©çš„è¡Œç‚ºæ–¹å¼ã€‚
ç”Ÿæ´»ä½œæ¯èˆ‡çªç™¼ç‹€æ³,ä»Šæ—¥ä¸»å‹•å”åŠ©å—å‚·çš„åŒå­¸å‰å¾€å¥åº·ä¸­å¿ƒï¼Œé€™ä»½ç†±å¿ƒåŠ©äººçš„ç‰¹è³ªéå¸¸é›£å¾—ï¼Œè€å¸«èˆ‡åŒå­¸éƒ½å¾ˆæ„Ÿè¬ä»–çš„ä»˜å‡ºï¼Œæ˜¯ç­ä¸Šçš„å°æš–ç”·/å°å¤©ä½¿ï¼
ç”Ÿæ´»ä½œæ¯èˆ‡çªç™¼ç‹€æ³,ä»Šå¤©ä¸Šèª²æ™‚é¡¯å¾—æœ‰äº›ç–²ç´¯ï¼Œå¶çˆ¾æœƒæåˆ°éŠæˆ²å…§å®¹ã€‚è€å¸«æ“”å¿ƒéåº¦ä½¿ç”¨3Cç”¢å“æœƒå½±éŸ¿å­©å­çš„å°ˆæ³¨åŠ›èˆ‡è¦–åŠ›ï¼Œå»ºè­°å®¶é•·èˆ‡å­©å­ç´„å®šæ¯æ—¥ä½¿ç”¨æ™‚é–“ï¼Œå…±åŒå®ˆè­·å­©å­çš„å¥åº·ã€‚
ç”Ÿæ´»ä½œæ¯èˆ‡çªç™¼ç‹€æ³,ä»Šå¤©æƒ…ç·’è¼ƒç‚ºæ³¢å‹•ï¼Œåœ¨æ ¡èˆ‡åŒå­¸ç™¼ç”Ÿäº†ä¸€é»å£è§’ã€‚è€å¸«å·²å¼•å°å­©å­ç·´ç¿’ã€å…ˆåœä¸‹ä¾†ã€å†æºé€šã€ï¼Œè«‹å®¶é•·å›å®¶å¾Œä¹Ÿå¤šè§€å¯Ÿå­©å­çš„å¿ƒæƒ…ï¼Œè‹¥æœ‰éœ€è¦åˆ†äº«çš„ç´°ç¯€ï¼Œéš¨æ™‚èˆ‡è€å¸«è¯çµ¡ã€‚
ç”Ÿæ´»ä½œæ¯èˆ‡çªç™¼ç‹€æ³,æŠµé”æ•™å®¤æ™‚å·²æ¥è¿‘ç¬¬ä¸€ç¯€èª²ï¼Œé€™å¯èƒ½æœƒè®“ä»–éŒ¯éæ™¨é–“é‡è¦çš„å®£å°äº‹é …ã€‚ç‚ºäº†è®“å­©å­æœ‰å……è£•çš„æ™‚é–“æ²‰æ¾±å¿ƒæƒ…è¿æ¥å­¸ç¿’ï¼Œè«‹å®¶é•·å”åŠ©å¼•å°å­©å­èª¿æ•´æ—©æ™¨å‡ºé–€çš„æ™‚é–“ï¼Œè¬è¬æ‚¨çš„é…åˆã€‚
å­¸ç¿’ç¿’æ…£èˆ‡å¸¸è¦æé†’,æœ€è¿‘åœ¨æ ¡èˆ‡åŒå­¸ç›¸è™•èæ´½ï¼Œä¸éè€å¸«ç™¼ç¾å­©å­çš„ä½œæ¥­æœ‰éºæ¼ç‹€æ³ã€‚ç‚ºäº†åŸ¹é¤Šå­©å­çš„è²¬ä»»æ„Ÿï¼Œè«‹å®¶é•·å”åŠ©æé†’ä¸¦ç¢ºèªå­©å­çš„æ›¸å¯«ç‹€æ³ï¼Œè®“æˆ‘å€‘ä¸€èµ·é™ªä¼´å­©å­å»ºç«‹è‰¯å¥½çš„å­¸ç¿’ç¿’æ…£ã€‚
å­¸ç¿’ç¿’æ…£èˆ‡å¸¸è¦æé†’,æœ€è¿‘åœ¨æ ¡èˆ‡åŒå­¸ç›¸è™•èæ´½ï¼Œä¸éè€å¸«ç™¼ç¾å­©å­çš„è¯çµ¡ç°¿æœ‰éºæ¼ç‹€æ³ã€‚ç‚ºäº†åŸ¹é¤Šå­©å­çš„è²¬ä»»æ„Ÿï¼Œè«‹å®¶é•·å”åŠ©æé†’ä¸¦ç¢ºèªå­©å­çš„æ›¸å¯«ç‹€æ³ï¼Œè®“æˆ‘å€‘ä¸€èµ·é™ªä¼´å­©å­å»ºç«‹è‰¯å¥½çš„å­¸ç¿’ç¿’æ…£ã€‚
å­¸ç¿’ç¿’æ…£èˆ‡å¸¸è¦æé†’,ä»Šæ—¥ä¸Šèª²æ…‹åº¦èªçœŸï¼Œå¯æƒœå¿˜äº†å¸¶èª²æœ¬ï¼Œç¨ç¨å½±éŸ¿äº†å­¸ç¿’ç¯€å¥ã€‚å»ºè­°å®¶é•·åœ¨ç¡å‰èƒ½æé†’å­©å­å†æ¬¡æ•´ç†æ›¸åŒ…ï¼Œé¤Šæˆæª¢æŸ¥å­¸ç”¨å“çš„ç¿’æ…£ï¼Œç›¸ä¿¡é€™æœƒè®“ä»–çš„å­¸ç¿’æ›´åŠ é †æš¢ã€‚
å­¸ç¿’ç¿’æ…£èˆ‡å¸¸è¦æé†’,ä»Šæ—¥ä¸Šèª²æ…‹åº¦èªçœŸï¼Œå¯æƒœå¿˜äº†å¸¶èª²æ–‡å…·ï¼Œç¨ç¨å½±éŸ¿äº†å­¸ç¿’ç¯€å¥ã€‚å»ºè­°å®¶é•·åœ¨ç¡å‰èƒ½æé†’å­©å­å†æ¬¡æ•´ç†æ›¸åŒ…ï¼Œé¤Šæˆæª¢æŸ¥å­¸ç”¨å“çš„ç¿’æ…£ï¼Œç›¸ä¿¡é€™æœƒè®“ä»–çš„å­¸ç¿’æ›´åŠ é †æš¢ã€‚
å­¸ç¿’ç¿’æ…£èˆ‡å¸¸è¦æé†’,å­©å­è¿‘æœŸåœ¨æ ¡åƒèˆ‡åº¦é«˜ï¼Œå”¯æ‰“æƒæ™‚é–“å®¹æ˜“å› èˆ‡åŒå­¸èŠå¤©è€Œåˆ†å¿ƒã€‚è€å¸«å·²æé†’å­©å­ã€å…ˆå®Œæˆä»½å…§å·¥ä½œå†ä¼‘æ¯ã€ï¼Œä¹Ÿè«‹å®¶é•·åœ¨å®¶å”åŠ©å¼•å°å­©å­åšå®¶äº‹çš„ç¿’æ…£ï¼ŒåŸ¹é¤Šè²¬ä»»å¿ƒã€‚
å­¸ç¿’ç¿’æ…£èˆ‡å¸¸è¦æé†’,é€™æ¬¡è€ƒå·åæ‡‰å‡ºéƒ¨åˆ†è§€å¿µå°šæœªå®Œå…¨å¸æ”¶ï¼Œè¨‚æ­£èˆ‡æª¢è¨æ˜¯é€²æ­¥çš„é—œéµã€‚è«‹å®¶é•·å”åŠ©ç£ä¿ƒå­©å­å°‡éŒ¯èª¤è™•é‡æ–°æ€è€ƒä¸¦å®Œæˆè¨‚æ­£ï¼Œç¢ºä¿åŸºç¤æ‰å¯¦ï¼Œè¾›è‹¦äº†ã€‚`;

    let currentData = { classes: {}, statuses: {}, webhook: "" };
    let selectedStudent = "";
    let isWholeClass = false; 

    window.onload = function() { loadData(); renderApp(); };

    function loadData() {
      let rawStudents = localStorage.getItem("app_students_lite") || localStorage.getItem("app_students_v6") || defaultStudents;
      let rawStatuses = localStorage.getItem("app_statuses_lite") || localStorage.getItem("app_statuses_v6") || defaultStatuses;
      currentData.webhook = localStorage.getItem("app_webhook_lite") || localStorage.getItem("app_webhook_v6") || "";

      currentData.classes = {};
      rawStudents.split('\n').forEach(line => {
        let parts = line.split(',');
        if (parts.length >= 3) {
          let cls = parts[0].trim(), no = parts[1].trim(), name = parts[2].trim();
          if(cls && name) {
            if (!currentData.classes[cls]) currentData.classes[cls] = [];
            currentData.classes[cls].push({ no, name });
          }
        }
      });

      currentData.statuses = {};
      rawStatuses.split('\n').forEach(line => {
        let parts = line.split(',');
        if (parts.length >= 2) {
          let cat = parts[0].trim(), item = parts[1].trim();
          if(cat && item) {
            if (!currentData.statuses[cat]) currentData.statuses[cat] = [];
            currentData.statuses[cat].push(item);
          }
        }
      });
    }

    function renderApp() {
      let clsSelect = document.getElementById('classSelect');
      let currentCls = clsSelect.value;
      clsSelect.innerHTML = '';
      Object.keys(currentData.classes).forEach(cls => { clsSelect.add(new Option(cls + " ç­", cls)); });
      if(currentCls && currentData.classes[currentCls]) clsSelect.value = currentCls;

      let statusSelect = document.getElementById('statusSelect');
      let currentStatus = statusSelect.value;
      statusSelect.innerHTML = '';
      Object.keys(currentData.statuses).forEach(cat => {
        let group = document.createElement('optgroup');
        group.label = cat;
        currentData.statuses[cat].forEach(item => { group.appendChild(new Option(item, item)); });
        statusSelect.add(group);
      });
      let customGroup = document.createElement('optgroup');
      customGroup.label = "è‡ªè¨‚åŠŸèƒ½";
      customGroup.appendChild(new Option("å…¶ä»–/è‡ªè¨‚ (ä¸‹æ–¹å®Œæ•´å¡«å¯«)", "å…¶ä»–/è‡ªè¨‚"));
      statusSelect.add(customGroup);
      
      let options = Array.from(statusSelect.options).map(o => o.value);
      if(options.includes(currentStatus)) statusSelect.value = currentStatus;

      renderStudents();
    }

    function renderStudents() {
      let cls = document.getElementById('classSelect').value;
      let grid = document.getElementById('studentGrid');
      grid.innerHTML = '';
      document.getElementById('previewCard').style.display = 'none';
      
      selectedStudent = ""; isWholeClass = false;
      document.getElementById('btnWholeClass').classList.remove('selected-whole');

      if (!currentData.classes[cls]) return;

      currentData.classes[cls].forEach(student => {
        let btn = document.createElement('button');
        btn.className = 'student-btn';
        btn.innerHTML = `<span class="btn-no">${student.no}</span><span class="btn-name">${student.name}</span>`;
        btn.onclick = () => selectStudent(btn, student.name);
        grid.appendChild(btn);
      });
    }

    function selectStudent(btnElement, name) {
      document.querySelectorAll('.student-btn').forEach(b => b.classList.remove('selected'));
      document.getElementById('btnWholeClass').classList.remove('selected-whole');
      btnElement.classList.add('selected');
      selectedStudent = name; isWholeClass = false;
      updatePreviewField(); showPreviewCard();
    }

    function selectWholeClass(btnElement) {
      document.querySelectorAll('.student-btn').forEach(b => b.classList.remove('selected'));
      btnElement.classList.add('selected-whole');
      selectedStudent = ""; isWholeClass = true;
      updatePreviewField(); showPreviewCard();
    }

    function showPreviewCard() {
      document.getElementById('previewCard').style.display = 'block';
      document.getElementById('previewCard').scrollIntoView({ behavior: 'smooth', block: 'end' });
    }

    document.getElementById('statusSelect').addEventListener('change', () => { if(selectedStudent || isWholeClass) updatePreviewField(); });
    document.getElementById('customNote').addEventListener('input', () => { if(selectedStudent || isWholeClass) updatePreviewField(); });

    function updatePreviewField() {
      let status = document.getElementById('statusSelect').value;
      let note = document.getElementById('customNote').value.trim();
      let coreContent = (status === "å…¶ä»–/è‡ªè¨‚" && note !== "") ? note : ((note !== "") ? status + note : status);
      
      let finalMessage = isWholeClass ? ("å„ä½å®¶é•·æ‚¨å¥½ï¼Œ" + coreContent) : ("å®¶é•·æ‚¨å¥½ï¼Œ" + selectedStudent + " " + coreContent);
      document.getElementById('msgPreview').value = finalMessage;
    }

    function saveToHistory(recipient, msg) {
      let history = JSON.parse(localStorage.getItem('app_history_lite') || localStorage.getItem('app_history_v6') || '[]');
      let now = new Date();
      let timeStr = `${now.getMonth()+1}/${now.getDate()} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
      history.unshift({ time: timeStr, to: recipient, text: msg });
      if (history.length > 50) history.pop(); 
      localStorage.setItem('app_history_lite', JSON.stringify(history));
    }

    function processSend(type) {
      let finalMsg = document.getElementById('msgPreview').value.trim();
      if(!finalMsg) { alert("è¨Šæ¯ä¸å¯ç‚ºç©ºï¼"); return; }
      
      let recipient = isWholeClass ? "å…¨ç­é€šçŸ¥" : selectedStudent;

      if (type === 'copy') {
        navigator.clipboard.writeText(finalMsg).then(() => {
          alert("âœ… æ–‡å­—å·²è¤‡è£½ï¼æ‚¨å¯ä»¥ç›´æ¥è²¼ä¸Šã€‚");
          saveToHistory(recipient, finalMsg);
          promptSaveEditedStatus(finalMsg);
        }).catch(err => alert("è¤‡è£½å¤±æ•—ï¼š" + err));
      } 
      else if (type === 'lineApp') {
        window.open('https://line.me/R/msg/text/?' + encodeURIComponent(finalMsg), '_blank');
        saveToHistory(recipient, finalMsg);
        promptSaveEditedStatus(finalMsg);
      } 
      else if (type === 'lineOA') {
        if (!currentData.webhook) { alert("âš ï¸ è«‹å…ˆè‡³ã€æ§åˆ¶å°ã€‘è¨­å®š Webhook ç¶²å€ã€‚"); return; }
        fetch(currentData.webhook, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ message: finalMsg }) })
        .then(res => { alert("å·²ç™¼é€è«‹æ±‚è‡³ Webhookï¼"); saveToHistory(recipient, finalMsg); promptSaveEditedStatus(finalMsg); })
        .catch(err => alert("ç™¼é€å¤±æ•—ï¼š" + err));
      }
    }

    function promptSaveEditedStatus(sentMsg) {
      let coreContent = sentMsg;
      if (isWholeClass) coreContent = coreContent.replace(/^å„ä½å®¶é•·æ‚¨å¥½ï¼Œ/, '').trim();
      else coreContent = coreContent.replace(new RegExp(`^å®¶é•·æ‚¨å¥½ï¼Œ${selectedStudent}\\s?`), '').trim();

      if (!coreContent) return;
      let exists = false;
      for (let cat in currentData.statuses) { if (currentData.statuses[cat].includes(coreContent)) { exists = true; break; } }

      if (!exists) {
        setTimeout(() => {
          if (confirm("âœ¨ ç™¼ç¾æ–°ç·¨è¼¯çš„å…§å®¹ï¼\nè«‹å•æ˜¯å¦è¦å°‡ä»¥ä¸‹æ–‡å­—åŠ å…¥ã€Œå¸¸ç”¨é€šçŸ¥äº‹é …ã€ä¸­ï¼Ÿ\n\n" + coreContent)) {
            let catName = prompt("è«‹ç‚ºé€™å€‹é€šçŸ¥è¼¸å…¥ä¸€å€‹ã€Œåˆ†é¡åç¨±ã€ï¼š", "è‡ªè¨‚æ–°å¢äº‹é …");
            if (catName) {
              if (!currentData.statuses[catName]) currentData.statuses[catName] = [];
              currentData.statuses[catName].push(coreContent);
              
              let newStatusesStr = "";
              for (let c in currentData.statuses) { currentData.statuses[c].forEach(item => { newStatusesStr += c + "," + item + "\n"; }); }
              localStorage.setItem("app_statuses_lite", newStatusesStr.trim());
              renderApp();
              alert("âœ… å·²æˆåŠŸåŠ å…¥å¸¸ç”¨æ¸…å–®ï¼");
              document.getElementById('customNote').value = "";
            }
          }
        }, 500);
      }
    }

    function openHistory() {
      let history = JSON.parse(localStorage.getItem('app_history_lite') || localStorage.getItem('app_history_v6') || '[]');
      let listHtml = history.length === 0 ? "<div class='no-history'>å°šç„¡ç™¼é€ç´€éŒ„</div>" : "";
      history.forEach(item => {
        listHtml += `<div class='history-item'><div class='history-time'>ğŸ•’ ${item.time}</div><div class='history-to'>ğŸ‘¤ å‚³é€çµ¦ï¼š${item.to}</div><div class='history-text'>${item.text}</div></div>`;
      });
      document.getElementById('historyList').innerHTML = listHtml;
      document.getElementById('historyModal').style.display = 'flex';
    }
    function closeHistory() { document.getElementById('historyModal').style.display = 'none'; }

    // --- æ§åˆ¶å°è¡¨æ ¼èˆ‡ Excel é‚è¼¯ ---
    function openSettings() {
      document.getElementById('settingWebhook').value = currentData.webhook;
      
      // è¼‰å…¥å­¸ç”Ÿè¡¨æ ¼
      let stuTbody = document.querySelector('#studentsTable tbody');
      stuTbody.innerHTML = '';
      let rawStudents = localStorage.getItem("app_students_lite") || localStorage.getItem("app_students_v6") || defaultStudents;
      rawStudents.split('\n').forEach(line => {
        let p = line.split(',');
        if (p.length >= 3) addTableRow('studentsTable', p[0].trim(), p[1].trim(), p[2].trim());
      });

      // è¼‰å…¥äº‹é …è¡¨æ ¼
      let statTbody = document.querySelector('#statusesTable tbody');
      statTbody.innerHTML = '';
      let rawStatuses = "";
      for (let c in currentData.statuses) { currentData.statuses[c].forEach(item => { rawStatuses += c + "," + item + "\n"; }); }
      if(!rawStatuses) rawStatuses = defaultStatuses;
      rawStatuses.split('\n').forEach(line => {
        let p = line.split(',');
        if (p.length >= 2) addTableRow('statusesTable', p[0].trim(), p[1].trim());
      });

      document.getElementById('settingsModal').style.display = 'flex';
    }
    function closeSettings() { document.getElementById('settingsModal').style.display = 'none'; }

    function addTableRow(tableId, val1='', val2='', val3='') {
      let tbody = document.querySelector(`#${tableId} tbody`);
      let tr = document.createElement('tr');
      if (tableId === 'studentsTable') {
        tr.innerHTML = `
          <td><input type="text" value="${val1}" placeholder="ä¾‹: 101"></td>
          <td><input type="text" value="${val2}" placeholder="ä¾‹: 1"></td>
          <td><input type="text" value="${val3}" placeholder="ä¾‹: ç‹å°æ˜"></td>
          <td style="text-align:center;"><button class="del-btn" onclick="this.closest('tr').remove()">åˆªé™¤</button></td>`;
      } else {
        tr.innerHTML = `
          <td><input type="text" value="${val1}" placeholder="ä¾‹: å¸¸è¦æé†’"></td>
          <td><input type="text" value="${val2}" placeholder="è¼¸å…¥é€šçŸ¥å…§å®¹..."></td>
          <td style="text-align:center;"><button class="del-btn" onclick="this.closest('tr').remove()">åˆªé™¤</button></td>`;
      }
      tbody.appendChild(tr);
    }

    function saveSettings() {
      // å¾è¡¨æ ¼æŠ“å–å­¸ç”Ÿè³‡æ–™
      let studentsArr = [];
      document.querySelectorAll('#studentsTable tbody tr').forEach(tr => {
        let inputs = tr.querySelectorAll('input');
        let cls = inputs[0].value.replace(/,/g, 'ï¼Œ').trim();
        let no = inputs[1].value.replace(/,/g, 'ï¼Œ').trim();
        let name = inputs[2].value.replace(/,/g, 'ï¼Œ').trim();
        if (cls && name) studentsArr.push(`${cls},${no},${name}`);
      });
      
      // å¾è¡¨æ ¼æŠ“å–äº‹é …è³‡æ–™
      let statusesArr = [];
      document.querySelectorAll('#statusesTable tbody tr').forEach(tr => {
        let inputs = tr.querySelectorAll('input');
        let cat = inputs[0].value.replace(/,/g, 'ï¼Œ').trim();
        let content = inputs[1].value.replace(/,/g, 'ï¼Œ').trim();
        if (cat && content) statusesArr.push(`${cat},${content}`);
      });

      let webhook = document.getElementById('settingWebhook').value.trim();

      if (studentsArr.length === 0 || statusesArr.length === 0) {
        alert("âš ï¸ å­¸ç”Ÿåå–®èˆ‡é€šçŸ¥äº‹é …ä¸èƒ½ç‚ºç©ºï¼"); return;
      }

      localStorage.setItem("app_students_lite", studentsArr.join('\n'));
      localStorage.setItem("app_statuses_lite", statusesArr.join('\n'));
      localStorage.setItem("app_webhook_lite", webhook);

      loadData(); renderApp(); closeSettings();
      alert("âœ… è¨­å®šå·²å„²å­˜ï¼");
    }

    // Excel ç¯„æœ¬ä¸‹è¼‰
    function downloadExcelTemplate() {
      if(typeof XLSX === 'undefined') { alert("è¼‰å…¥å¥—ä»¶ä¸­ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚"); return; }
      
      // å–å¾—ç›®å‰çš„è³‡æ–™ä¾†åšç¯„æœ¬ (å¦‚æœæ²’æœ‰å°±ç”¨ç©ºçš„æ¨™é¡Œ)
      let studentsData = [["ç­ç´š", "åº§è™Ÿ", "å§“å"]];
      document.querySelectorAll('#studentsTable tbody tr').forEach(tr => {
        let inputs = tr.querySelectorAll('input');
        if(inputs[0].value || inputs[2].value) studentsData.push([inputs[0].value, inputs[1].value, inputs[2].value]);
      });
      if(studentsData.length === 1) studentsData.push(["101", "1", "ç‹å°æ˜"]);

      let statusesData = [["åˆ†é¡", "å…§å®¹"]];
      document.querySelectorAll('#statusesTable tbody tr').forEach(tr => {
        let inputs = tr.querySelectorAll('input');
        if(inputs[0].value || inputs[1].value) statusesData.push([inputs[0].value, inputs[1].value]);
      });
      if(statusesData.length === 1) statusesData.push(["å¸¸è¦æé†’", "ä½œæ¥­é‚„æ²’äº¤ã€‚"]);

      const wb = XLSX.utils.book_new();
      const wsStudents = XLSX.utils.aoa_to_sheet(studentsData);
      const wsStatuses = XLSX.utils.aoa_to_sheet(statusesData);
      
      XLSX.utils.book_append_sheet(wb, wsStudents, "å­¸ç”Ÿåå–®");
      XLSX.utils.book_append_sheet(wb, wsStatuses, "é€šçŸ¥äº‹é …");
      XLSX.writeFile(wb, "ç­ç´šäº‹å‹™é€šçŸ¥_è³‡æ–™ç¯„æœ¬.xlsx");
    }

    // Excel åŒ¯å…¥
    function importExcel(event) {
      const file = event.target.files[0];
      if(!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, {type: 'array'});
          
          let importCount = 0;

          if(workbook.Sheets["å­¸ç”Ÿåå–®"]) {
            const studentJson = XLSX.utils.sheet_to_json(workbook.Sheets["å­¸ç”Ÿåå–®"], {header:1});
            let stuTbody = document.querySelector('#studentsTable tbody');
            stuTbody.innerHTML = '';
            for(let i=1; i<studentJson.length; i++) {
               let row = studentJson[i];
               if(row.length >= 1 && (row[0] || row[2])) {
                 addTableRow('studentsTable', row[0]||'', row[1]||'', row[2]||'');
                 importCount++;
               }
            }
          } else { alert("æ‰¾ä¸åˆ°åç¨±ç‚ºã€Œå­¸ç”Ÿåå–®ã€çš„å·¥ä½œè¡¨ã€‚"); }

          if(workbook.Sheets["é€šçŸ¥äº‹é …"]) {
            const statusJson = XLSX.utils.sheet_to_json(workbook.Sheets["é€šçŸ¥äº‹é …"], {header:1});
            let statTbody = document.querySelector('#statusesTable tbody');
            statTbody.innerHTML = '';
            for(let i=1; i<statusJson.length; i++) {
               let row = statusJson[i];
               if(row.length >= 2 && row[0] && row[1]) {
                 addTableRow('statusesTable', row[0]||'', row[1]||'');
                 importCount++;
               }
            }
          } else { alert("æ‰¾ä¸åˆ°åç¨±ç‚ºã€Œé€šçŸ¥äº‹é …ã€çš„å·¥ä½œè¡¨ã€‚"); }

          if(importCount > 0) alert("ğŸ‰ æˆåŠŸåŒ¯å…¥è³‡æ–™è‡³è¡¨æ ¼ä¸­ï¼\nè«‹ç¢ºèªç„¡èª¤å¾Œé»æ“Šæœ€ä¸‹æ–¹çš„ã€Œå„²å­˜è¡¨æ ¼è³‡æ–™ä¸¦è¼‰å…¥ã€ã€‚");
          
        } catch(err) {
          alert("è§£æ Excel å¤±æ•—ï¼Œè«‹ç¢ºèªæª”æ¡ˆæ ¼å¼æ˜¯å¦æ­£ç¢ºã€‚");
        }
        // æ¸…é™¤ input file ä»¥ä¾¿ä¸‹æ¬¡é‡è¤‡åŒ¯å…¥åŒæª”å
        document.getElementById('excelUpload').value = ""; 
      };
      reader.readAsArrayBuffer(file);
    }

    // ç›¸å®¹èˆŠç‰ˆä»£ç¢¼åŒ¯å‡ºåŒ¯å…¥
    function exportData() {
      let data = {
        students: localStorage.getItem("app_students_lite") || defaultStudents,
        statuses: localStorage.getItem("app_statuses_lite") || defaultStatuses,
        webhook: document.getElementById('settingWebhook').value.trim()
      };
      navigator.clipboard.writeText(JSON.stringify(data)).then(() => alert("âœ… å‚™ä»½ä»£ç¢¼å·²è¤‡è£½ï¼")).catch(err => alert("è¤‡è£½å¤±æ•—"));
    }
    function importData() {
      let code = prompt("ğŸ“¥ è«‹åœ¨æ­¤è²¼ä¸Šæ‚¨çš„å‚™ä»½ä»£ç¢¼ï¼š");
      if (!code) return;
      try {
        let data = JSON.parse(code);
        if (data.students && data.statuses) {
          localStorage.setItem("app_students_lite", data.students);
          localStorage.setItem("app_statuses_lite", data.statuses);
          if(data.webhook) localStorage.setItem("app_webhook_lite", data.webhook);
          loadData(); openSettings(); // é‡æ–°æ•´ç†è¡¨æ ¼
          alert("ğŸ‰ åŒ¯å…¥æˆåŠŸï¼è³‡æ–™å·²å¡«å…¥è¡¨æ ¼ã€‚");
        }
      } catch(e) { alert("âŒ ä»£ç¢¼ç„¡æ•ˆã€‚"); }
    }
  </script>
</body>
</html>